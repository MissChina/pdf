<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šç…§ç‰‡è½¬PDFå·¥å…· - é«˜çº§ç‰ˆ</title>
    <!-- å¼•å…¥jsPDFåº“ç”¨äºPDFç”Ÿæˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- å¼•å…¥JSZipåº“ç”¨äºZIPå‹ç¼©åŒ…ç”Ÿæˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- å¼•å…¥FileSaveråº“ç”¨äºæ–‡ä»¶ä¸‹è½½ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- å¼•å…¥exif-jsåº“ç”¨äºè¯»å–EXIFä¿¡æ¯ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.js"></script>
    <!-- å¼•å…¥Sortable.jsåº“ç”¨äºæ‹–æ‹½æ’åº -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <!-- å¼•å…¥QRCode.jsåº“ç”¨äºäºŒç»´ç ç”Ÿæˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .description {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
        }
        .upload-area {
            border: 2px dashed #3498db;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #f8fafc;
        }
        .upload-area:hover {
            border-color: #2980b9;
            background-color: #eef5fd;
        }
        .upload-icon {
            font-size: 40px;
            color: #3498db;
            margin-bottom: 10px;
        }
        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        .preview-item {
            position: relative;
            width: 150px;
            height: 150px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .preview-item:hover {
            transform: scale(1.03);
        }
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .preview-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .preview-item .info-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 12px;
            padding: 3px 5px;
            text-align: center;
        }
        .preview-item .remove-btn:hover {
            background-color: rgba(192, 57, 43, 0.9);
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .clear-btn {
            background-color: #e74c3c;
            color: white;
        }
        .clear-btn:hover {
            background-color: #c0392b;
        }
        .generate-btn {
            background-color: #2ecc71;
            color: white;
        }
        .generate-btn:hover {
            background-color: #27ae60;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .options {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .option-group {
            margin-bottom: 15px;
        }
        .option-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .option-description {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        .compression-slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        .compression-slider {
            flex-grow: 1;
        }
        .slider-value {
            width: 35px;
            text-align: center;
        }
        .tabbed-buttons {
            display: flex;
            margin-bottom: 10px;
        }
        .tab-button {
            flex: 1;
            padding: 10px;
            text-align: center;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-button:first-child {
            border-radius: 4px 0 0 4px;
        }
        .tab-button:last-child {
            border-radius: 0 4px 4px 0;
        }
        .tab-button.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }
        .status-bar {
            margin-top: 10px;
            height: 20px;
            position: relative;
            display: none;
        }
        .status-progress {
            height: 100%;
            width: 0;
            background-color: #3498db;
            position: absolute;
            border-radius: 4px;
            transition: width 0.3s;
        }
        .status-text {
            position: absolute;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 12px;
            line-height: 20px;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        /* æç¤ºæ¡†æ ·å¼ */
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: help;
        }
        .tooltip-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 12px;
            line-height: 16px;
        }
        .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            line-height: 1.4;
        }
        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* ä¸»é¢˜åˆ‡æ¢æ ·å¼ */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 20px;
            z-index: 1000;
            transition: all 0.3s;
        }
        .theme-toggle:hover {
            background: #2980b9;
            transform: scale(1.1);
        }
        
        /* æš—é»‘ä¸»é¢˜ */
        .dark-theme {
            background-color: #2c3e50;
            color: #ecf0f1;
        }
        .dark-theme .container {
            background-color: #34495e;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        .dark-theme .upload-area {
            background-color: #3c5168;
            border-color: #5dade2;
        }
        .dark-theme .upload-area:hover {
            background-color: #4a6180;
        }
        .dark-theme .options {
            background-color: #3c5168;
            border-color: #566b7a;
        }
        .dark-theme .tab-button {
            background-color: #34495e;
            border-color: #566b7a;
            color: #ecf0f1;
        }
        .dark-theme .tab-button.active {
            background-color: #3498db;
        }
        
        /* å›¾ç‰‡ç¼–è¾‘å·¥å…·æ æ ·å¼ */
        .edit-toolbar {
            position: absolute;
            top: 30px;
            left: 5px;
            right: 5px;
            display: none;
            flex-wrap: wrap;
            gap: 3px;
            z-index: 10;
        }
        .preview-item:hover .edit-toolbar {
            display: flex;
        }
        .edit-btn {
            background: rgba(52, 152, 219, 0.9);
            color: white;
            border: none;
            border-radius: 3px;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .edit-btn:hover {
            background: rgba(41, 128, 185, 1);
        }
        
        /* å¤šé¡µé¢å¸ƒå±€é€‰é¡¹ */
        .layout-grid {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .layout-option {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .layout-option:hover {
            background-color: #f0f8ff;
        }
        .layout-option.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        /* å›¾ç‰‡ç¼–è¾‘æ¨¡æ€æ¡† */
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .edit-modal.show {
            display: flex;
        }
        .edit-modal-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            max-width: 90vw;
            max-height: 90vh;
            overflow: auto;
        }
        .edit-canvas {
            max-width: 100%;
            max-height: 60vh;
            border: 1px solid #ddd;
        }
        .edit-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .slider-group label {
            font-size: 12px;
            font-weight: bold;
        }
        
        /* è¯­è¨€åˆ‡æ¢æ ·å¼ */
        .lang-toggle {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            z-index: 1000;
            transition: all 0.3s;
        }
        .lang-toggle:hover {
            background: #219a52;
        }
        
        /* æ‹–æ‹½æ’åºæ ·å¼ */
        .preview-item.sortable-ghost {
            opacity: 0.5;
        }
        .preview-item.sortable-drag {
            transform: rotate(5deg);
        }
        
        /* EXIFä¿¡æ¯æ˜¾ç¤º */
        .exif-info {
            position: absolute;
            top: 50px;
            left: 5px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            font-size: 10px;
            padding: 3px 5px;
            border-radius: 3px;
            max-width: 140px;
            display: none;
            word-wrap: break-word;
        }
        .preview-item:hover .exif-info {
            display: block;
        }
        
        /* åˆ†æ‰¹å¤„ç†è¿›åº¦æ¡ */
        .batch-progress {
            margin-top: 10px;
            display: none;
        }
        .batch-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .batch-item:last-child {
            border-bottom: none;
        }
        .batch-status {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .batch-status.pending {
            background: #f39c12;
            color: white;
        }
        .batch-status.processing {
            background: #3498db;
            color: white;
        }
        .batch-status.completed {
            background: #27ae60;
            color: white;
        }
        .batch-status.error {
            background: #e74c3c;
            color: white;
        }
        
        /* æ°´å°è®¾ç½® */
        .watermark-options {
            display: none;
            margin-top: 10px;
            padding: 10px;
            border: 1px dashed #ddd;
            border-radius: 4px;
        }
        .watermark-preview {
            width: 100px;
            height: 70px;
            border: 1px solid #ddd;
            margin: 10px 0;
            position: relative;
            background: #f9f9f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #666;
        }
        
        /* å¿«æ·é”®æç¤º */
        .shortcuts-help {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            display: none;
            z-index: 1000;
        }
        .shortcuts-help.show {
            display: block;
        }
        
        /* å“åº”å¼è®¾è®¡å¢å¼º */
        @media (max-width: 768px) {
            .preview-item {
                width: 120px;
                height: 120px;
            }
            .edit-toolbar {
                top: 25px;
            }
            .edit-btn {
                width: 20px;
                height: 20px;
                font-size: 10px;
            }
            .theme-toggle {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            .lang-toggle {
                font-size: 10px;
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button class="theme-toggle" id="themeToggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
    
    <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
    <button class="lang-toggle" id="langToggle" title="åˆ‡æ¢è¯­è¨€">EN</button>
    
    <!-- å¿«æ·é”®å¸®åŠ© -->
    <div class="shortcuts-help" id="shortcutsHelp">
        <div><strong>å¿«æ·é”®:</strong></div>
        <div>Ctrl+O: æ‰“å¼€æ–‡ä»¶</div>
        <div>Ctrl+S: ä¿å­˜è®¾ç½®</div>
        <div>Ctrl+G: ç”ŸæˆPDF</div>
        <div>Delete: åˆ é™¤é€‰ä¸­å›¾ç‰‡</div>
        <div>F1: æ˜¾ç¤º/éšè—å¸®åŠ©</div>
    </div>
    
    <div class="container">
        <h1 data-lang-key="title">å¤šç…§ç‰‡è½¬PDFå·¥å…·</h1>
        <p class="description" data-lang-key="description">ä¸Šä¼ å¤šå¼ ç…§ç‰‡ï¼Œå°†å®ƒä»¬è½¬æ¢ä¸ºé«˜è´¨é‡PDFæ–‡ä»¶</p>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ“</div>
            <p>ç‚¹å‡»æˆ–æ‹–æ‹½ç…§ç‰‡åˆ°è¿™é‡Œä¸Šä¼ </p>
            <p style="font-size: 14px; color: #7f8c8d;">æ”¯æŒJPGã€PNGç­‰å¸¸è§å›¾ç‰‡æ ¼å¼</p>
            <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
        </div>
        
        <div class="options">
            <div class="option-group">
                <div class="option-title">PDFè´¨é‡æ¨¡å¼</div>
                <div class="option-description">é€‰æ‹©åŸå§‹è´¨é‡ä¿æŒå®Œå…¨ä¸å¤±çœŸï¼Œé€‰æ‹©ä¼˜åŒ–è´¨é‡å¯å‡å°æ–‡ä»¶ä½“ç§¯</div>
                <div class="tabbed-buttons">
                    <div class="tab-button active" data-mode="original">åŸå§‹è´¨é‡</div>
                    <div class="tab-button" data-mode="optimized">ä¼˜åŒ–è´¨é‡</div>
                </div>
                
                <div id="optimizedOptions" style="display: none; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ddd;">
                    <div class="option-title">å‹ç¼©çº§åˆ«
                        <div class="tooltip">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">å‹ç¼©çº§åˆ«è¶Šé«˜ï¼Œæ–‡ä»¶ä½“ç§¯è¶Šå°ï¼Œä½†å›¾åƒè´¨é‡å¯èƒ½ç•¥æœ‰é™ä½ã€‚æ¨èé€‰æ‹©80-90ä¹‹é—´çš„å€¼ä»¥å¹³è¡¡è´¨é‡å’Œå¤§å°ã€‚</span>
                        </div>
                    </div>
                    <div class="compression-slider-container">
                        <input type="range" id="compressionLevel" class="compression-slider" min="50" max="100" value="85" step="5">
                        <span id="compressionValue" class="slider-value">85%</span>
                    </div>
                    <div class="option-description">æ›´é«˜çš„æ•°å€¼ = æ›´å¥½çš„è´¨é‡ï¼Œæ›´å¤§çš„æ–‡ä»¶</div>
                    
                    <div class="option-title" style="margin-top: 10px;">æœ€å¤§åˆ†è¾¨ç‡é™åˆ¶
                        <div class="tooltip">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">è¶…è¿‡æ­¤åˆ†è¾¨ç‡çš„å›¾ç‰‡å°†è¢«ç­‰æ¯”ä¾‹ç¼©å°ã€‚è¾ƒä½çš„åˆ†è¾¨ç‡å¯ä»¥æ˜¾è‘—å‡å°‘PDFå¤§å°è€Œä¸æ˜æ˜¾å½±å“æ‰“å°è´¨é‡ã€‚</span>
                        </div>
                    </div>
                    <select id="maxResolution">
                        <option value="0">æ— é™åˆ¶ (åŸå§‹åˆ†è¾¨ç‡)</option>
                        <option value="2000">2000åƒç´  (ä¼˜è´¨æ‰“å°)</option>
                        <option value="1500" selected>1500åƒç´  (æ¨èå¹³è¡¡å€¼)</option>
                        <option value="1200">1200åƒç´  (è‰¯å¥½è´¨é‡)</option>
                        <option value="1000">1000åƒç´  (æ™®é€šè´¨é‡)</option>
                    </select>
                </div>
            </div>
            
            <div class="option-group">
                <div class="option-title">PDFé¡µé¢å¤§å°</div>
                <select id="pageSize">
                    <option value="a4" selected>A4 (210 Ã— 297 mm)</option>
                    <option value="a3">A3 (297 Ã— 420 mm)</option>
                    <option value="letter">Letter (216 Ã— 279 mm)</option>
                </select>
            </div>
            
            <div class="option-group">
                <div class="option-title">é¡µé¢æ–¹å‘</div>
                <label>
                    <input type="radio" name="orientation" value="portrait" checked> çºµå‘
                </label>
                <label>
                    <input type="radio" name="orientation" value="landscape"> æ¨ªå‘
                </label>
            </div>
            
            <div class="option-group">
                <div class="option-title" data-lang-key="layout_mode">å›¾ç‰‡å¸ƒå±€æ¨¡å¼</div>
                <div class="layout-grid">
                    <div class="layout-option active" data-layout="single" data-lang-key="single_page">å•é¡µå•å›¾</div>
                    <div class="layout-option" data-layout="grid2" data-lang-key="grid_2">2å›¾ç½‘æ ¼</div>
                    <div class="layout-option" data-layout="grid4" data-lang-key="grid_4">4å›¾ç½‘æ ¼</div>
                    <div class="layout-option" data-layout="grid6" data-lang-key="grid_6">6å›¾ç½‘æ ¼</div>
                </div>
            </div>
            
            <div class="option-group">
                <div class="option-title" data-lang-key="page_margins">é¡µè¾¹è·è®¾ç½®</div>
                <div class="compression-slider-container">
                    <span data-lang-key="margin_small">å°</span>
                    <input type="range" id="pageMargin" min="5" max="30" value="10" step="5">
                    <span id="marginValue">10mm</span>
                    <span data-lang-key="margin_large">å¤§</span>
                </div>
            </div>
            
            <div class="option-group">
                <div class="option-title" data-lang-key="watermark_settings">æ°´å°è®¾ç½®</div>
                <label>
                    <input type="checkbox" id="enableWatermark"> <span data-lang-key="enable_watermark">å¯ç”¨æ°´å°</span>
                </label>
                <div class="watermark-options" id="watermarkOptions">
                    <div>
                        <label data-lang-key="watermark_text">æ°´å°æ–‡å­—:</label>
                        <input type="text" id="watermarkText" placeholder="æ°´å°å†…å®¹" value="CONFIDENTIAL">
                    </div>
                    <div>
                        <label data-lang-key="watermark_opacity">é€æ˜åº¦:</label>
                        <input type="range" id="watermarkOpacity" min="10" max="80" value="30">
                        <span id="watermarkOpacityValue">30%</span>
                    </div>
                    <div class="watermark-preview" id="watermarkPreview">
                        <span>æ°´å°é¢„è§ˆ</span>
                    </div>
                </div>
            </div>
            
            <div class="option-group">
                <div class="option-title" data-lang-key="page_numbering">é¡µç è®¾ç½®</div>
                <label>
                    <input type="checkbox" id="enablePageNumbers"> <span data-lang-key="enable_page_numbers">æ·»åŠ é¡µç </span>
                </label>
            </div>
            
            <div class="option-group">
                <div class="option-title">æ–‡ä»¶å</div>
                <input type="text" id="fileName" placeholder="ç…§ç‰‡é›†" value="ç…§ç‰‡é›†">
            </div>
        </div>
        
        <div class="preview-container" id="previewContainer"></div>
        
        <div class="controls">
            <button id="clearBtn" class="clear-btn" data-lang-key="clear_all">æ¸…é™¤æ‰€æœ‰ç…§ç‰‡</button>
            <button id="saveConfigBtn" class="clear-btn" data-lang-key="save_config">ä¿å­˜é…ç½®</button>
            <button id="loadConfigBtn" class="clear-btn" data-lang-key="load_config">åŠ è½½é…ç½®</button>
            <button id="exportZipBtn" class="clear-btn" data-lang-key="export_zip">å¯¼å‡ºZIP</button>
            <button id="generateBtn" class="generate-btn" disabled data-lang-key="generate_pdf">ç”ŸæˆPDF</button>
        </div>
        
        <!-- åˆ†æ‰¹å¤„ç†è¿›åº¦ -->
        <div class="batch-progress" id="batchProgress">
            <h4 data-lang-key="batch_processing">æ‰¹å¤„ç†è¿›åº¦:</h4>
            <div id="batchList"></div>
        </div>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨å¤„ç†ç…§ç‰‡å¹¶ç”ŸæˆPDFï¼Œè¯·ç¨å€™...</p>
            <div class="status-bar" id="statusBar">
                <div class="status-progress" id="statusProgress"></div>
                <div class="status-text" id="statusText">å¤„ç†ä¸­...</div>
            </div>
        </div>
    </div>
    
    <!-- å›¾ç‰‡ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="edit-modal" id="editModal">
        <div class="edit-modal-content">
            <h3 data-lang-key="edit_image">ç¼–è¾‘å›¾ç‰‡</h3>
            <canvas id="editCanvas" class="edit-canvas"></canvas>
            <div class="edit-controls">
                <button class="edit-btn" onclick="rotateImage(90)" title="å‘å³æ—‹è½¬90Â°">â†»</button>
                <button class="edit-btn" onclick="rotateImage(-90)" title="å‘å·¦æ—‹è½¬90Â°">â†º</button>
                <button class="edit-btn" onclick="flipImage('horizontal')" title="æ°´å¹³ç¿»è½¬">â‡„</button>
                <button class="edit-btn" onclick="flipImage('vertical')" title="å‚ç›´ç¿»è½¬">â‡…</button>
                
                <div class="slider-group">
                    <label data-lang-key="brightness">äº®åº¦</label>
                    <input type="range" id="brightnessSlider" min="-50" max="50" value="0">
                </div>
                
                <div class="slider-group">
                    <label data-lang-key="contrast">å¯¹æ¯”åº¦</label>
                    <input type="range" id="contrastSlider" min="-50" max="50" value="0">
                </div>
                
                <div class="slider-group">
                    <label data-lang-key="saturation">é¥±å’Œåº¦</label>
                    <input type="range" id="saturationSlider" min="-50" max="50" value="0">
                </div>
                
                <button class="edit-btn" onclick="applyFilter('grayscale')" data-lang-key="grayscale">é»‘ç™½</button>
                <button class="edit-btn" onclick="applyFilter('sepia')" data-lang-key="sepia">å¤å¤</button>
                <button class="edit-btn" onclick="resetFilters()" data-lang-key="reset">é‡ç½®</button>
                
                <button class="generate-btn" onclick="saveImageEdit()" data-lang-key="save_edit">ä¿å­˜ç¼–è¾‘</button>
                <button class="clear-btn" onclick="closeEditModal()" data-lang-key="cancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ç”¨äºé…ç½®åŠ è½½ -->
    <input type="file" id="configFileInput" accept=".json" style="display: none;">
    
    <div class="footer">
        <p data-lang-key="footer">Â© 2025 å¤šç…§ç‰‡è½¬PDFå·¥å…· - é™æ€æ— åç«¯å®ç°</p>
    </div>

    <script>
        // å¤šè¯­è¨€æ”¯æŒ
        const translations = {
            'zh-CN': {
                title: 'å¤šç…§ç‰‡è½¬PDFå·¥å…·',
                description: 'ä¸Šä¼ å¤šå¼ ç…§ç‰‡ï¼Œå°†å®ƒä»¬è½¬æ¢ä¸ºé«˜è´¨é‡PDFæ–‡ä»¶',
                layout_mode: 'å›¾ç‰‡å¸ƒå±€æ¨¡å¼',
                single_page: 'å•é¡µå•å›¾',
                grid_2: '2å›¾ç½‘æ ¼',
                grid_4: '4å›¾ç½‘æ ¼',
                grid_6: '6å›¾ç½‘æ ¼',
                page_margins: 'é¡µè¾¹è·è®¾ç½®',
                margin_small: 'å°',
                margin_large: 'å¤§',
                watermark_settings: 'æ°´å°è®¾ç½®',
                enable_watermark: 'å¯ç”¨æ°´å°',
                watermark_text: 'æ°´å°æ–‡å­—',
                watermark_opacity: 'é€æ˜åº¦',
                page_numbering: 'é¡µç è®¾ç½®',
                enable_page_numbers: 'æ·»åŠ é¡µç ',
                clear_all: 'æ¸…é™¤æ‰€æœ‰ç…§ç‰‡',
                save_config: 'ä¿å­˜é…ç½®',
                load_config: 'åŠ è½½é…ç½®',
                export_zip: 'å¯¼å‡ºZIP',
                generate_pdf: 'ç”ŸæˆPDF',
                batch_processing: 'æ‰¹å¤„ç†è¿›åº¦',
                edit_image: 'ç¼–è¾‘å›¾ç‰‡',
                brightness: 'äº®åº¦',
                contrast: 'å¯¹æ¯”åº¦',
                saturation: 'é¥±å’Œåº¦',
                grayscale: 'é»‘ç™½',
                sepia: 'å¤å¤',
                reset: 'é‡ç½®',
                save_edit: 'ä¿å­˜ç¼–è¾‘',
                cancel: 'å–æ¶ˆ',
                footer: 'Â© 2025 å¤šç…§ç‰‡è½¬PDFå·¥å…· - é™æ€æ— åç«¯å®ç°'
            },
            'en': {
                title: 'Multi-Photo to PDF Converter',
                description: 'Upload multiple photos and convert them to high-quality PDF files',
                layout_mode: 'Image Layout Mode',
                single_page: 'Single Image',
                grid_2: '2-Grid',
                grid_4: '4-Grid',
                grid_6: '6-Grid',
                page_margins: 'Page Margins',
                margin_small: 'Small',
                margin_large: 'Large',
                watermark_settings: 'Watermark Settings',
                enable_watermark: 'Enable Watermark',
                watermark_text: 'Watermark Text',
                watermark_opacity: 'Opacity',
                page_numbering: 'Page Numbering',
                enable_page_numbers: 'Add Page Numbers',
                clear_all: 'Clear All Photos',
                save_config: 'Save Config',
                load_config: 'Load Config',
                export_zip: 'Export ZIP',
                generate_pdf: 'Generate PDF',
                batch_processing: 'Batch Processing Progress',
                edit_image: 'Edit Image',
                brightness: 'Brightness',
                contrast: 'Contrast',
                saturation: 'Saturation',
                grayscale: 'Grayscale',
                sepia: 'Sepia',
                reset: 'Reset',
                save_edit: 'Save Edit',
                cancel: 'Cancel',
                footer: 'Â© 2025 Multi-Photo to PDF Converter - Static Implementation'
            }
        };
        
        // å…¨å±€å˜é‡
        let currentLang = 'zh-CN';
        let isDarkTheme = false;
        let uploadedImages = [];
        let qualityMode = 'original';
        let currentLayoutMode = 'single';
        let currentEditingIndex = -1;
        let originalImageData = null;
        let sortableInstance = null;
        let duplicateHashes = new Set();
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
        
        // åˆå§‹åŒ–åº”ç”¨
        function initializeApp() {
            initializeElements();
            initializeEventListeners();
            initializeSortable();
            initializeKeyboardShortcuts();
            loadUserPreferences();
            updateLanguage();
        }
        
        // åˆå§‹åŒ–DOMå…ƒç´ 
        function initializeElements() {
            // åŸºç¡€å…ƒç´ 
            window.uploadArea = document.getElementById('uploadArea');
            window.fileInput = document.getElementById('fileInput');
            window.previewContainer = document.getElementById('previewContainer');
            window.clearBtn = document.getElementById('clearBtn');
            window.generateBtn = document.getElementById('generateBtn');
            window.loading = document.getElementById('loading');
            window.fileNameInput = document.getElementById('fileName');
            window.pageSizeSelect = document.getElementById('pageSize');
            window.compressionLevelSlider = document.getElementById('compressionLevel');
            window.compressionValueDisplay = document.getElementById('compressionValue');
            window.maxResolutionSelect = document.getElementById('maxResolution');
            window.statusBar = document.getElementById('statusBar');
            window.statusProgress = document.getElementById('statusProgress');
            window.statusText = document.getElementById('statusText');
            window.optimizedOptions = document.getElementById('optimizedOptions');
            window.tabButtons = document.querySelectorAll('.tab-button');
            
            // æ–°å¢å…ƒç´ 
            window.themeToggle = document.getElementById('themeToggle');
            window.langToggle = document.getElementById('langToggle');
            window.shortcutsHelp = document.getElementById('shortcutsHelp');
            window.layoutOptions = document.querySelectorAll('.layout-option');
            window.pageMarginSlider = document.getElementById('pageMargin');
            window.marginValue = document.getElementById('marginValue');
            window.enableWatermark = document.getElementById('enableWatermark');
            window.watermarkOptions = document.getElementById('watermarkOptions');
            window.watermarkText = document.getElementById('watermarkText');
            window.watermarkOpacity = document.getElementById('watermarkOpacity');
            window.watermarkOpacityValue = document.getElementById('watermarkOpacityValue');
            window.enablePageNumbers = document.getElementById('enablePageNumbers');
            window.saveConfigBtn = document.getElementById('saveConfigBtn');
            window.loadConfigBtn = document.getElementById('loadConfigBtn');
            window.exportZipBtn = document.getElementById('exportZipBtn');
            window.configFileInput = document.getElementById('configFileInput');
            window.batchProgress = document.getElementById('batchProgress');
            window.batchList = document.getElementById('batchList');
            window.editModal = document.getElementById('editModal');
            window.editCanvas = document.getElementById('editCanvas');
            window.brightnessSlider = document.getElementById('brightnessSlider');
            window.contrastSlider = document.getElementById('contrastSlider');
            window.saturationSlider = document.getElementById('saturationSlider');
            
            // åˆå§‹åŒ–æ˜¾ç¤ºå€¼
            compressionValueDisplay.textContent = compressionLevelSlider.value + '%';
            marginValue.textContent = pageMarginSlider.value + 'mm';
            watermarkOpacityValue.textContent = watermarkOpacity.value + '%';
        }
            
            // ç›‘å¬å‹ç¼©çº§åˆ«æ»‘å—å˜åŒ–
            compressionLevelSlider.addEventListener('input', function() {
                compressionValueDisplay.textContent = this.value + '%';
            });
            
            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæ—¶è§¦å‘æ–‡ä»¶é€‰æ‹©
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            // å¤„ç†æ‹–æ”¾äº‹ä»¶
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = '#27ae60';
                this.style.backgroundColor = '#e8f6f1';
            });
            
            uploadArea.addEventListener('dragleave', function() {
                this.style.borderColor = '#3498db';
                this.style.backgroundColor = '#f8fafc';
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = '#3498db';
                this.style.backgroundColor = '#f8fafc';
                
                if (e.dataTransfer.files.length > 0) {
                    handleFiles(e.dataTransfer.files);
                }
            });
            
            // ç›‘å¬æ–‡ä»¶é€‰æ‹©å˜åŒ–
            fileInput.addEventListener('change', function() {
                if (fileInput.files.length > 0) {
                    handleFiles(fileInput.files);
                    fileInput.value = ''; // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡å¤é€‰æ‹©ç›¸åŒçš„æ–‡ä»¶
                }
            });
            
            // å¤„ç†è´¨é‡æ¨¡å¼é€‰é¡¹å¡åˆ‡æ¢
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    qualityMode = this.dataset.mode;
                    
                    // æ˜¾ç¤ºæˆ–éšè—ä¼˜åŒ–é€‰é¡¹
                    if (qualityMode === 'optimized') {
                        optimizedOptions.style.display = 'block';
                    } else {
                        optimizedOptions.style.display = 'none';
                    }
                });
            });
            
            // å¤„ç†é€‰æ‹©çš„æ–‡ä»¶
            function handleFiles(files) {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    // ç¡®ä¿æ–‡ä»¶æ˜¯å›¾ç‰‡
                    if (!file.type.match('image.*')) {
                        alert('æ–‡ä»¶ "' + file.name + '" ä¸æ˜¯å›¾ç‰‡æ ¼å¼ï¼Œå·²è·³è¿‡');
                        continue;
                    }
                    
                    // æ·»åŠ æ–‡ä»¶åˆ°æ•°ç»„
                    uploadedImages.push({
                        file: file,
                        size: formatFileSize(file.size)
                    });
                    
                    // åˆ›å»ºé¢„è§ˆ
                    const reader = new FileReader();
                    reader.onload = (function(fileData) {
                        return function(e) {
                            createPreviewItem(fileData, e.target.result);
                        };
                    })({file: file, size: formatFileSize(file.size)});
                    reader.readAsDataURL(file);
                }
                
                // å¦‚æœæœ‰å›¾ç‰‡åˆ™å¯ç”¨ç”ŸæˆæŒ‰é’®
                updateGenerateButton();
            }
            
            // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
            function formatFileSize(bytes) {
                if (bytes < 1024) {
                    return bytes + ' B';
                } else if (bytes < 1024 * 1024) {
                    return (bytes / 1024).toFixed(1) + ' KB';
                } else {
                    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
                }
            }
            
            // åˆ›å»ºé¢„è§ˆé¡¹
            function createPreviewItem(fileData, imgSrc) {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
                const img = document.createElement('img');
                img.src = imgSrc;
                img.title = fileData.file.name;
                
                // åˆ›å»ºç§»é™¤æŒ‰é’®
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = 'Ã—';
                removeBtn.title = 'ç§»é™¤æ­¤å›¾ç‰‡';
                removeBtn.addEventListener('click', function(e) {
                    e.stopPropagation(); // é˜²æ­¢è§¦å‘å¤–å±‚å®¹å™¨çš„ç‚¹å‡»äº‹ä»¶
                    
                    // ä»æ•°ç»„å’ŒDOMä¸­ç§»é™¤è¯¥å›¾ç‰‡
                    const index = uploadedImages.findIndex(item => item.file === fileData.file);
                    if (index > -1) {
                        uploadedImages.splice(index, 1);
                    }
                    previewContainer.removeChild(previewItem);
                    updateGenerateButton();
                });
                
                // åˆ›å»ºä¿¡æ¯æ ‡ç­¾æ˜¾ç¤ºå›¾ç‰‡å¤§å°
                const infoLabel = document.createElement('div');
                infoLabel.className = 'info-label';
                infoLabel.textContent = fileData.size;
                
                previewItem.appendChild(img);
                previewItem.appendChild(removeBtn);
                previewItem.appendChild(infoLabel);
                previewContainer.appendChild(previewItem);
            }
            
            // æ›´æ–°ç”ŸæˆæŒ‰é’®çŠ¶æ€
            function updateGenerateButton() {
                generateBtn.disabled = uploadedImages.length === 0;
            }
            
            // æ¸…é™¤æ‰€æœ‰ç…§ç‰‡
            clearBtn.addEventListener('click', function() {
                uploadedImages = [];
                previewContainer.innerHTML = '';
                updateGenerateButton();
            });
            
            // ç”ŸæˆPDF
            generateBtn.addEventListener('click', async function() {
                if (uploadedImages.length === 0) return;
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                loading.style.display = 'block';
                statusBar.style.display = 'block';
                generateBtn.disabled = true;
                
                try {
                    // è·å–ç”¨æˆ·é€‰æ‹©çš„PDFé€‰é¡¹
                    const pageSize = pageSizeSelect.value;
                    const orientation = document.querySelector('input[name="orientation"]:checked').value;
                    const layout = document.querySelector('input[name="layout"]:checked').value;
                    const fileName = fileNameInput.value.trim() || 'ç…§ç‰‡é›†';
                    
                    // ä¼˜åŒ–è´¨é‡æ¨¡å¼çš„å‚æ•°
                    const compressionLevel = parseInt(compressionLevelSlider.value) / 100;
                    const maxResolution = parseInt(maxResolutionSelect.value);
                    
                    // åˆ›å»ºä¸€ä¸ªæ–°çš„jsPDFå®ä¾‹
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF(orientation, 'mm', pageSize);
                    
                    // è·å–é¡µé¢å°ºå¯¸
                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const pageHeight = pdf.internal.pageSize.getHeight();
                    
                    // å¤„ç†æ¯å¼ å›¾ç‰‡
                    for (let i = 0; i < uploadedImages.length; i++) {
                        // æ›´æ–°è¿›åº¦
                        const progress = Math.round((i / uploadedImages.length) * 100);
                        statusProgress.style.width = progress + '%';
                        statusText.textContent = `å¤„ç†ç¬¬ ${i+1}/${uploadedImages.length} å¼ å›¾ç‰‡...`;
                        
                        // å…è®¸UIæ›´æ–°
                        await new Promise(resolve => setTimeout(resolve, 0));
                        
                        // å¦‚æœä¸æ˜¯ç¬¬ä¸€é¡µï¼Œæ·»åŠ æ–°é¡µ
                        if (i > 0) {
                            pdf.addPage(pageSize, orientation);
                        }
                        
                        // å‡†å¤‡å›¾ç‰‡
                        let imgData;
                        const file = uploadedImages[i].file;
                        
                        if (qualityMode === 'original') {
                            // åŸå§‹è´¨é‡æ¨¡å¼ - ç›´æ¥ä½¿ç”¨å›¾ç‰‡
                            imgData = await processImageWithOriginalQuality(file);
                        } else {
                            // ä¼˜åŒ–è´¨é‡æ¨¡å¼ - å‹ç¼©å›¾ç‰‡
                            imgData = await processImageWithOptimizedQuality(file, compressionLevel, maxResolution);
                        }
                        
                        // è®¡ç®—å›¾ç‰‡é€‚åº”é¡µé¢çš„å°ºå¯¸
                        const dimensions = calculateDimensions(imgData, pageWidth, pageHeight, layout);
                        
                        // åœ¨PDFä¸­æ·»åŠ å›¾ç‰‡
                        pdf.addImage(
                            imgData, 
                            'JPEG', 
                            dimensions.x, 
                            dimensions.y, 
                            dimensions.width, 
                            dimensions.height, 
                            undefined, 
                            'FAST'  // ä½¿ç”¨FASTé€‰é¡¹ä»¥è·å¾—æ›´å¥½çš„è´¨é‡
                        );
                        
                        // æ·»åŠ å›¾ç‰‡æ–‡ä»¶åä½œä¸ºå¯é€‰æ ‡é¢˜ï¼ˆåº•éƒ¨å°å­—ï¼‰
                        const imgName = file.name;
                        pdf.setFontSize(8);
                        pdf.setTextColor(150);
                        const textWidth = pdf.getStringUnitWidth(imgName) * 8 / pdf.internal.scaleFactor;
                        const textX = (pageWidth - textWidth) / 2;
                        pdf.text(imgName, textX, pageHeight - 5);
                    }
                    
                    // æ›´æ–°çŠ¶æ€ä¸ºå®Œæˆ
                    statusProgress.style.width = '100%';
                    statusText.textContent = 'ç”ŸæˆPDFå®Œæˆï¼';
                    
                    // ä¿å­˜PDF
                    setTimeout(() => {
                        pdf.save(`${fileName}${qualityMode === 'optimized' ? '_ä¼˜åŒ–' : '_åŸå§‹'}.pdf`);
                        
                        // éšè—åŠ è½½çŠ¶æ€
                        loading.style.display = 'none';
                        statusBar.style.display = 'none';
                        generateBtn.disabled = false;
                    }, 500);
                    
                } catch (error) {
                    console.error('ç”ŸæˆPDFæ—¶å‡ºé”™:', error);
                    alert('ç”ŸæˆPDFæ—¶å‡ºé”™ï¼Œè¯·é‡è¯•');
                    loading.style.display = 'none';
                    statusBar.style.display = 'none';
                    generateBtn.disabled = false;
                }
            });
            
            // å¤„ç†åŸå§‹è´¨é‡çš„å›¾ç‰‡
            async function processImageWithOriginalQuality(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            resolve(img);
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            // å¤„ç†ä¼˜åŒ–è´¨é‡çš„å›¾ç‰‡
            async function processImageWithOptimizedQuality(file, quality, maxResolution) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            // åˆ›å»ºcanvaså…ƒç´ è¿›è¡Œå›¾ç‰‡å¤„ç†
                            const canvas = document.createElement('canvas');
                            let width = img.width;
                            let height = img.height;
                            
                            // å¦‚æœè®¾ç½®äº†æœ€å¤§åˆ†è¾¨ç‡å¹¶ä¸”å›¾ç‰‡å°ºå¯¸è¶…è¿‡é™åˆ¶ï¼Œåˆ™æŒ‰æ¯”ä¾‹ç¼©å°
                            if (maxResolution > 0 && (width > maxResolution || height > maxResolution)) {
                                if (width > height) {
                                    height = Math.round(height * (maxResolution / width));
                                    width = maxResolution;
                                } else {
                                    width = Math.round(width * (maxResolution / height));
                                    height = maxResolution;
                                }
                            }
                            
                            // è®¾ç½®canvaså°ºå¯¸
                            canvas.width = width;
                            canvas.height = height;
                            
                            // ç»˜åˆ¶å›¾ç‰‡åˆ°canvas
                            const ctx = canvas.getContext('2d');
                            
                            // ä½¿ç”¨é«˜è´¨é‡å›¾åƒæ¸²æŸ“
                            ctx.imageSmoothingEnabled = true;
                            ctx.imageSmoothingQuality = 'high';
                            
                            // ç»˜åˆ¶å›¾åƒ
                            ctx.drawImage(img, 0, 0, width, height);
                            
                            // è½¬æ¢ä¸ºå›¾åƒæ•°æ®ï¼Œä½¿ç”¨è®¾å®šçš„è´¨é‡
                            const dataUrl = canvas.toDataURL('image/jpeg', quality);
                            
                            // åˆ›å»ºæ–°å›¾åƒå¯¹è±¡ä»¥è¿”å›
                            const optimizedImg = new Image();
                            optimizedImg.onload = function() {
                                resolve(optimizedImg);
                            };
                            optimizedImg.src = dataUrl;
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            // è®¡ç®—å›¾åƒåœ¨PDFé¡µé¢ä¸Šçš„å°ºå¯¸å’Œä½ç½®
            function calculateDimensions(img, pageWidth, pageHeight, layout) {
                const margin = 10; // é¡µé¢è¾¹è·ï¼ˆæ¯«ç±³ï¼‰
                const maxWidth = pageWidth - 2 * margin;
                const maxHeight = pageHeight - 2 * margin;
                
                // è®¡ç®—å›¾åƒçºµæ¨ªæ¯”
                const imageRatio = img.width / img.height;
                
                // ç¡®å®šé€‚åˆé¡µé¢çš„å°ºå¯¸
                let width, height;
                
                if (layout === 'fit') {
                    // é€‚åº”æ¨¡å¼ - ä¿æŒçºµæ¨ªæ¯”
                    if (imageRatio > maxWidth / maxHeight) {
                        // å›¾åƒæ›´å®½
                        width = maxWidth;
                        height = width / imageRatio;
                    } else {
                        // å›¾åƒæ›´é«˜
                        height = maxHeight;
                        width = height * imageRatio;
                    }
                } else {
                    // å¡«å……æ¨¡å¼ - å¡«æ»¡é¡µé¢ï¼ˆå¯èƒ½è£å‰ªéƒ¨åˆ†å›¾åƒï¼‰
                    const pageRatio = maxWidth / maxHeight;
                    
                    if (imageRatio > pageRatio) {
                        // å›¾åƒæ›´å®½ï¼Œä»¥é«˜åº¦ä¸ºå‡†
                        height = maxHeight;
                        width = height * imageRatio;
                    } else {
                        // å›¾åƒæ›´é«˜ï¼Œä»¥å®½åº¦ä¸ºå‡†
                        width = maxWidth;
                        height = width / imageRatio;
                    }
                }
                
                // è®¡ç®—å±…ä¸­ä½ç½®
                const x = (pageWidth - width) / 2;
                const y = (pageHeight - height) / 2;
                
                return { x, y, width, height };
            }
        });
    </script>
</body>
</html>